# front-build
The idea behind this tiny build configuration is to make starting new projects easier by separating the webpack config in two parts:
- that which concerns the selection of tools, which is messy but luckily rarely changes,
- that which depends on the structure of a particular project, which may change from project to project but is a lot easier to look at when not tangled with the former.

## Tools

### For CSS
- compiles Sass (using `node-sass` or `dart-sass`, the former is faster and exposes a nice JavaScript API, the latter gets new features sooner)
- minifies with `cssnano`
- combines duplicated selectors thanks to `postcss-combine-duplicated-selectors`
- combines media queries using `css-mqpacker`
- adds vendor prefixes (`autoprefixer`)

### For JavaScript
- Webpack (who would have guessed)
- Babel with preset-env + class properties & decorators support

### Other
- automatically inlines small files imported in CSS or JS (`url-loader`)
- allows requiring Twig files in JS, which get compiled to JS functions thanks to the `twig` and `twig-loader` libraries (great for sharing templates between your front-end and back-end code)

## Usage

1. Clone the repo or just copy `getWebpackConfig.js` into your project (but make sure the dependencies specified in `package.json` are installed).

2. Create your own `webpack.config.js` with the options you like, e.g.:
```JS
module.exports = require('./getWebpackConfig')({
  scripts: {
    index: 'src/index.js'
  }
});
```

3. Run:
- `yarn start` - development watch mode
- `yarn build` - build for production

### Configuration
The `getWebpackConfig` function takes an options object parameter through which it exposes a limited set of Webpack's configuration.

- `outputPath` - path into which the compiled files are to be saved; default: `build`
- `scripts` - a map of JavaScript files, where the key is the target file name (without extension) and the value is the path to the entry file
- `styles` - same as above but for CSS

**BEWARE**: The keys in "scripts" and "styles" must be different, i.e. you can't e.g. compile your scripts to `index.js` and your styles to `index.css`. This is because Webpack always generates a `*.js` file for every entry file, regardless of the type. Here we simply delete all JS files with names corresponding to the keys in the `styles` object so only a CSS file (generated by `mini-css-extract-plugin`) is left, but it means that if you have a script with the same name, it will be possibly overwritten and then deleted. Let me know if you know a way to go around this.

- `roots` - an array of paths from which you want to import/require JavaScript modules using the absolute syntax, e.g. `import foo from 'foo'`
- `externals` - libraries in the global scope that you want to import in your JavaScript, e.g.:
```JS
// in webpack.config.js
externals: { jquery: 'jQuery' }

// in production code
import $ from 'jquery';
```
- `alias` - similar to `roots` but works both in JavaScript and CSS (however, in CSS, it must be prefixed with `~`), e.g.
```JS
alias: { images: 'assets/images/' }
```
```SCSS
.section {
  background-image: url('~images/bg.jpg')
}
```
- `sassFunctions` - allows you to pass your JavaScript functions so that they can be used in your Sass code; useful for sharing general theme settings between JS & CSS
- `devMode` - whether we're compiling for production or development (affects mostly source maps) - default: the `NODE_ENV` environment variable
